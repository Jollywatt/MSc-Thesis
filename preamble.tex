% STRUCTURE AND LAYOUT

\documentclass[
	paper=a4,
	fontsize=12pt,
	open=any,
	headings=twolinechapter,
]{scrbook}


\newcommand{\notewidth}{4cm}
\newcommand{\notesep}{6mm}
\usepackage[
	\ifdebug showframe,\fi
	inner=20mm,
	marginparwidth=\notewidth,
	marginparsep=\notesep,
	outer=\dimexpr10mm + \notewidth + \notesep,
	bottom=4cm,
]{geometry}

\usepackage{layout}


\usepackage{mparhack} % improved margin note positioning
\usepackage{sidenotes}

	% minimum vertical space between sidenotes
	\setlength\marginparpush{15pt}

	% make sidenote font size smaller
	% https://tex.stackexchange.com/q/361622/105570
	\makeatletter
	\RenewDocumentCommand\sidenotetext{ o o +m }{%	  
		\IfNoValueOrEmptyTF{#1}{%
			\@sidenotes@placemarginal{#2}{\textsuperscript{\thesidenote}{}~\footnotesize#3}%
			\refstepcounter{sidenote}%
		}{%
			\@sidenotes@placemarginal{#2}{\textsuperscript{#1}~#3}%
		}%
	}
	\makeatother

	% make sidenotes ragged
	% https://tex.stackexchange.com/a/359580/105570
	\makeatletter
	\RenewDocumentCommand \@sidenotes@placemarginal { m m }
	{
	  \IfNoValueOrEmptyTF{#1}
		{\marginpar[{\raggedleftmarginnote #2}]{\raggedrightmarginnote #2}}
		{\marginnote{#2}[#1]}%
	}
	\makeatother



% DEBUGGING

\usepackage{lipsum}
\usepackage{layout}

\newcommand{\toself}[1]{\iffinal\else\textcolor{blue}{\{\textsc{to self:} #1\}}\fi}
\newcommand{\todo}[1]{\iffinal\else\textcolor{purple}{\{\textsc{to do:} #1\}}\fi}
\newcommand{\urgent}[1]{\iffinal\else\textcolor{red}{\{\textsc{urgent:} #1\}}\fi}



% MATHEMATICS

\usepackage[
	math-style=ISO,
	warnings-off={mathtools-colon,mathtools-overbracket},
]{unicode-math}
\usepackage{physics}

\input{symbols}


\usepackage{amsthm}
	\newtheorem{definition}{Definition}
	\newtheorem{theorem}{Theorem}
	\newtheorem{lemma}{Lemma}
	\newtheorem{corollary}{Corollary}
	\newtheorem{proposition}{Proposition}


% TYPOGRAPHY

\setmainfont{Libertinus Serif}
% \setsansfont{Libertinus Sans}
% \setmathfont{Libertinus Math}

\linespread{1.05}

\newcommand{\textdef}{\textsc}


% REFERENCING

\usepackage[numbers,sort&compress]{natbib}
\bibliographystyle{my-thesis-style}
\usepackage{doi}

\usepackage{xcolor}
\usepackage{hyperref}
	\hypersetup{
		colorlinks,
		linkcolor={red!50!black},
		urlcolor={blue!60!black},
		citecolor={green!50!black},
	}

\usepackage{cleveref}

% AUTONUM HACKS %
	% supress dumb warning
	% https://tex.stackexchange.com/a/285953/105570
	\let\globcount\newcount
	\expandafter\def\csname ver@etex.sty\endcsname{3000/12/31}
\usepackage{autonum}
	% make \Cref work as well as \cref
	% https://tex.stackexchange.com/a/471654/105570
	\makeatletter
	\autonum@generatePatchedReferenceCSL{Cref}
	\makeatother
